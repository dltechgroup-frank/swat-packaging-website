---
import type { Locale } from '../../i18n/config';
import { t } from '../../i18n/utils';

interface Props {
  locale?: Locale;
}

const { locale = 'es' } = Astro.props;

const sessions = [
  {
    number: 1,
    date: locale === 'es' ? 'Viernes 20 de Marzo' : 'Friday March 20',
    topic: locale === 'es' ? 'Diseño Corrugado e Innovación Estructural' : 'Corrugated Design & Structural Innovation',
    speaker: 'Ivan Alcaraz',
    icsFile: '/calendar/session-1.ics',
    googleUrl: 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=Webinar+SWAT:+Dise%C3%B1o+Corrugado+-+Ivan+Alcaraz&dates=20260320T170000Z/20260320T180000Z&details=Serie+de+Webinars+Packaging+Inteligente+2026%0APlataforma:+Zoom&location=Zoom',
  },
  {
    number: 2,
    date: locale === 'es' ? 'Viernes 27 de Marzo' : 'Friday March 27',
    topic: locale === 'es' ? 'Pruebas ISTA y Aseguramiento de Calidad' : 'ISTA Testing & Quality Assurance',
    speaker: 'Angel Pelgot',
    icsFile: '/calendar/session-2.ics',
    googleUrl: 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=Webinar+SWAT:+Pruebas+ISTA+-+Angel+Pelgot&dates=20260327T170000Z/20260327T180000Z&details=Serie+de+Webinars+Packaging+Inteligente+2026%0APlataforma:+Zoom&location=Zoom',
  },
  {
    number: 3,
    date: locale === 'es' ? 'Viernes 3 de Abril' : 'Friday April 3',
    topic: locale === 'es' ? 'Diseño de Empaque e Innovación de Materiales' : 'Packaging Design & Material Innovation',
    speaker: 'Sergio Darío Taboada',
    icsFile: '/calendar/session-3.ics',
    googleUrl: 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=Webinar+SWAT:+Dise%C3%B1o+Empaque+-+Sergio+Taboada&dates=20260403T170000Z/20260403T180000Z&details=Serie+de+Webinars+Packaging+Inteligente+2026%0APlataforma:+Zoom&location=Zoom',
  },
  {
    number: 4,
    date: locale === 'es' ? 'Viernes 10 de Abril' : 'Friday April 10',
    topic: locale === 'es' ? 'Estrategia de Empaque y Cadena de Suministro' : 'Packaging Strategy & Supply Chain',
    speaker: 'José Luis Castro',
    icsFile: '/calendar/session-4.ics',
    googleUrl: 'https://calendar.google.com/calendar/render?action=TEMPLATE&text=Webinar+SWAT:+Cadena+Suministro+-+Jos%C3%A9+Luis+Castro&dates=20260410T170000Z/20260410T180000Z&details=Serie+de+Webinars+Packaging+Inteligente+2026%0APlataforma:+Zoom&location=Zoom',
  },
];
---

<div id="success-banner" class="hidden fixed inset-0 z-50 overflow-y-auto" role="dialog" aria-modal="true">
  <div class="fixed inset-0 bg-black/60 backdrop-blur-sm" id="success-backdrop"></div>
  <div class="flex min-h-full items-center justify-center p-4">
    <div class="relative bg-white rounded-2xl shadow-2xl max-w-2xl w-full p-8 lg:p-10">
      <!-- Close button -->
      <button id="success-close" class="absolute top-4 right-4 text-veritiv-400 hover:text-veritiv-700 transition-colors" aria-label="Close">
        <svg class="w-6 h-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
          <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <!-- Check mark -->
      <div class="flex justify-center mb-6">
        <div class="w-16 h-16 rounded-full bg-green-100 flex items-center justify-center">
          <svg class="w-8 h-8 text-green-600" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M4.5 12.75l6 6 9-13.5" />
          </svg>
        </div>
      </div>

      <!-- Title -->
      <h2 class="text-2xl font-bold text-veritiv-900 text-center mb-2">
        {locale === 'es' ? '¡Registro Confirmado!' : 'Registration Confirmed!'}
      </h2>
      <p class="text-body-muted text-center mb-8">
        {locale === 'es'
          ? 'Agrega las sesiones a tu calendario para no perderte ninguna.'
          : 'Add the sessions to your calendar so you don\'t miss any.'}
      </p>

      <!-- Session cards -->
      <div class="space-y-3 mb-6">
        {sessions.map((session) => (
          <div class="flex flex-col sm:flex-row sm:items-center gap-3 p-4 rounded-xl bg-surface-light border border-veritiv-100">
            <div class="flex-1 min-w-0">
              <div class="flex items-center gap-2 mb-1">
                <span class="w-7 h-7 rounded-full bg-accent-500 text-white text-xs font-bold flex items-center justify-center flex-shrink-0">
                  {session.number}
                </span>
                <span class="text-sm font-semibold text-veritiv-900 truncate">{session.topic}</span>
              </div>
              <p class="text-xs text-body-muted ml-9">{session.date} · {session.speaker}</p>
            </div>
            <div class="flex items-center gap-2 ml-9 sm:ml-0 flex-shrink-0">
              <a
                href={session.googleUrl}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-blue-50 text-blue-700 hover:bg-blue-100 transition-colors"
              >
                <svg class="w-3.5 h-3.5" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M19.5 22h-15A2.5 2.5 0 012 19.5v-15A2.5 2.5 0 014.5 2h15A2.5 2.5 0 0122 4.5v15a2.5 2.5 0 01-2.5 2.5zM6 7v2h2V7H6zm4 0v2h8V7h-8zM6 11v2h2v-2H6zm4 0v2h8v-2h-8zM6 15v2h2v-2H6zm4 0v2h8v-2h-8z"/>
                </svg>
                Google
              </a>
              <a
                href={session.icsFile}
                download
                class="inline-flex items-center gap-1.5 px-3 py-1.5 text-xs font-medium rounded-lg bg-veritiv-50 text-veritiv-700 hover:bg-veritiv-100 transition-colors"
              >
                <svg class="w-3.5 h-3.5" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M3 16.5v2.25A2.25 2.25 0 005.25 21h13.5A2.25 2.25 0 0021 18.75V16.5M16.5 12L12 16.5m0 0L7.5 12m4.5 4.5V3" />
                </svg>
                .ics
              </a>
            </div>
          </div>
        ))}
      </div>

      <!-- WhatsApp reminder -->
      <p class="text-xs text-body-muted text-center">
        {locale === 'es'
          ? 'Te enviaremos el link de Zoom antes de cada sesión por correo electrónico.'
          : 'We\'ll send you the Zoom link before each session via email.'}
      </p>
    </div>
  </div>
</div>

<script is:inline>
  (function() {
    const params = new URLSearchParams(window.location.search);
    if (params.get('registered') === 'true') {
      const banner = document.getElementById('success-banner');
      if (banner) {
        banner.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
      }
      // Clean URL without reload
      const url = new URL(window.location.href);
      url.searchParams.delete('registered');
      window.history.replaceState({}, '', url.pathname);
    }

    // Close handlers
    function closeBanner() {
      const banner = document.getElementById('success-banner');
      if (banner) {
        banner.classList.add('hidden');
        document.body.style.overflow = '';
      }
    }

    document.getElementById('success-close')?.addEventListener('click', closeBanner);
    document.getElementById('success-backdrop')?.addEventListener('click', closeBanner);
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') closeBanner();
    });
  })();
</script>
